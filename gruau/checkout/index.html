<script>
  (function () {
    // Read URL params from Meta
    const params = new URLSearchParams(window.location.search);
    const productsParam = params.get("products");
    const coupon = params.get("coupon") || null;

    if (!productsParam) {
      alert("No product was passed from Facebook Shop.");
      window.location.href = "/returns/index.html?status=error";
      return;
    }

    // Example: "t8mytpb1b0:1" or "t8mytpb1b0:1,d5caaulmbr:1"
    const firstEntry = productsParam.split(",")[0];
    const productId = firstEntry.split(":")[0];

    // Map Meta product IDs â†’ PayPal payment links
    const PAYPAL_LINKS = {
      t8mytpb1b0: "https://www.paypal.com/ncp/payment/VGEFJPB7B6PLE", // Yellow ink
      d5caaulmbr: "https://www.paypal.com/ncp/payment/3QKGCNFHDARQQ"  // Black Swan
    };

    const baseUrl = PAYPAL_LINKS[productId];

    if (!baseUrl) {
      alert("Unknown or unmapped product ID: " + productId);
      window.location.href = "/returns/index.html?status=unknown_product";
      return;
    }

    // Build final PayPal URL (optionally add coupon for tracking)
    let checkoutURL = baseUrl;
    if (coupon) {
      checkoutURL += (checkoutURL.includes("?") ? "&" : "?") +
        "coupon=" + encodeURIComponent(coupon);
    }

    // Redirect to PayPal
    window.location.href = checkoutURL;
  })();
</script>
