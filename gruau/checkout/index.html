<script>
  const params = new URLSearchParams(window.location.search);
  const products = params.get("products");
  const coupon = params.get("coupon") || "";

  if (!products) {
    alert("No product received.");
    window.location.href = "/gruau/checkout/return.html?status=error";
  }

  // Meta format: productId:qty
  const [productId, qty] = products.split(":");

  if (!productId) {
    alert("Could not read product ID.");
    window.location.href = "/gruau/checkout/return.html?status=error";
  }

  // Build redirect to resolver page
  let url = `/gruau/checkout/resolve.html?product_id=${productId}`;

  if (coupon) {
    url += `&coupon=${encodeURIComponent(coupon)}`;
  }

  window.location.href = url;
</script>
